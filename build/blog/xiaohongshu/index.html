<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="RocketMQ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="RocketMQ Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="RocketMQ" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/second-blog/rss.xml" title="RocketMQ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/second-blog/atom.xml" title="RocketMQ Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/third-blog/rss.xml" title="RocketMQ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/third-blog/atom.xml" title="RocketMQ Blog Atom Feed"><title data-react-helmet="true">小红书消息中间件的运维实践与治理之路 | RocketMQ</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/xiaohongshu"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="小红书消息中间件的运维实践与治理之路 | RocketMQ"><meta data-react-helmet="true" name="description" content="小红书消息中间件的运维实践与治理之路"><meta data-react-helmet="true" property="og:description" content="小红书消息中间件的运维实践与治理之路"><meta data-react-helmet="true" property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gas4ezy6j20sg0g0weu.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gas4ezy6j20sg0g0weu.jpg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-06-21T15:45:26.155Z"><meta data-react-helmet="true" property="article:tag" content="用户案例"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/xiaohongshu"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/xiaohongshu" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/xiaohongshu" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://R2IYF7ETH7-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.dfbfb882.css">
<link rel="preload" href="/assets/js/runtime~main.aff9d6ee.js" as="script">
<link rel="preload" href="/assets/js/main.e5c35568.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/Apache_RocketMQ_logo.svg.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/Apache_RocketMQ_logo.svg.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">RocketMQ</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs">文档</a><a class="navbar__item navbar__link" href="/download">下载</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">博客</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/blog">用户案例</a></li><li><a class="dropdown__link" href="/second-blog">社区活动</a></li><li><a class="dropdown__link" href="/third-blog">版本变化</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/info">项目信息</a></li><li><a class="dropdown__link" href="/contact">加入我们</a></li><li><a class="dropdown__link" href="/team">贡献团队</a></li><li><a class="dropdown__link" href="/team">贡献说明</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/xiaohongshu">小红书消息中间件的运维实践与治理之路</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">小红书消息中间件的运维实践与治理之路</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2022-06-21T15:45:26.155Z" itemprop="datePublished">June 21, 2022</time> · 3 min read</div></header><meta itemprop="image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gas4ezy6j20sg0g0weu.jpg"><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="1-消息队列业务场景与挑战"></a>1. 消息队列业务场景与挑战<a class="hash-link" href="#1-消息队列业务场景与挑战" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="11-整体规模"></a>1.1 整体规模<a class="hash-link" href="#11-整体规模" title="Direct link to heading">#</a></h3><p>下图展示了 RocketMQ 和 Kafka 的总体规模。其中峰值  TPS 的 8000w/s 一般出现在晚上下班以后的时间段，写入量达到50GB/s，每天新增2-3PB数据，节点数1200+个。</p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gaz0px0oj21c40bumyo.jpg" alt="Example banner">;<h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="12-业务架构"></a>1.2 业务架构<a class="hash-link" href="#12-业务架构" title="Direct link to heading">#</a></h3><p>虽然 RocketMQ 和 Kafka 的性能相似，但在使用场景上还是有所区别的。RocketMQ 丰富的业务特性更适用于在线业务场景，而 Kafka 的高吞吐性使其更偏向离线、近线业务。当然，在实际应用中也会有交叉使用的现象，有时在线业务也会使用 Kafka 解耦，有的流处理数据也会使用 RocketMQ 存储。</p><p>业务总体架构如下图所示，业务日志和APP用户行为打点类的内容会发给 Kafka，数据库增量日志、在线业务、线上数据交换等会发给 RocketMQ。Kafka 和 RocketMQ 中的数据会有一部分流入 flink 中构建实时数仓、离线数仓以及一些数据产品（如报表、监控，等），RocketMQ 中另一部分数据会用于在线业务APP异步解耦。</p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gb1can0cj21c60no40y.jpg" alt="Example banner">;<h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="13-稳定性挑战"></a>1.3 稳定性挑战<a class="hash-link" href="#13-稳定性挑战" title="Direct link to heading">#</a></h3><p>a.   背景：
小红书整体收敛消息组件较晚，公司技术架构最大的目标是提升系统稳定性；</p><p>b.   挑战：
现存消息组件使用量极大，但没有稳定性保障；同时面临人手紧缺、时间紧，对MQ原理了解不深入的困境；</p><p>c.   策略：
先做监控，增强集群的可观测能力是了解其健康状况的最高效手段。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="14-稳定性治理"></a>1.4 稳定性治理<a class="hash-link" href="#14-稳定性治理" title="Direct link to heading">#</a></h3><p>除了监控告警，我们在稳定性治理方面还做了以下改造工作：
a.   引擎：资源隔离，新增监控打点等；
b.   平台：工单审核，权限管控，业务追溯；
c.   治理：针对集群可视化能力和集群可运维能力的建设；</p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h3gb3mslkpj21680scabg.jpg" alt="Example banner">;</div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/用户案例">用户案例</a></li></ul></div></footer></article></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-消息队列业务场景与挑战" class="table-of-contents__link">1. 消息队列业务场景与挑战</a><ul><li><a href="#11-整体规模" class="table-of-contents__link">1.1 整体规模</a></li><li><a href="#12-业务架构" class="table-of-contents__link">1.2 业务架构</a></li><li><a href="#13-稳定性挑战" class="table-of-contents__link">1.3 稳定性挑战</a></li><li><a href="#14-稳定性治理" class="table-of-contents__link">1.4 稳定性治理</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>公众号<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Meetup<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.aff9d6ee.js"></script>
<script src="/assets/js/main.e5c35568.js"></script>
</body>
</html>